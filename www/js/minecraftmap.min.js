/**** @Preserve
 v1.7

 Copyright 2014 Glenn Fisher

 This is an unofficial mapping system for Minecraft. It is neither produced nor 
 endorsed by Mojang.

 Licenced under GPL licence, version 3 or later
 https://www.gnu.org/copyleft/gpl.html

 Note that other files in this project have their own licence, see \licence.md
*****/
function isEmpty(e){return!e||0===e.length}function isString(e){return"string"==typeof e||e instanceof String}function isNotEmptyString(e){return("string"==typeof e||e instanceof String)&&e.length>0}function isFunction(e){return"function"==typeof e}function stringToBool(e){switch(trim(e).toLowerCase()){case"true":case"on":case"yes":case"1":return!0;case"false":case"off":case"no":case"0":case null:return!1;default:return Boolean(string)}}function imageToCanvas(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t}function trimRight(e){return isFunction(e.trimRight)?e.trimRight():e.replace(/\s+$/,"")}function trimLeft(e){return isFunction(e.trimLeft)?e.trimLeft():e.replace(/^\s+/,"")}function trim(e){return isFunction(e.trim)?e.trim():e.replace(/^\s+|\s+$/g,"")}function parseURL(e){var t=document.createElement("a");return t.href=e,{source:e,protocol:t.protocol.replace(":",""),host:t.hostname,port:t.port,query:t.search,params:function(){for(var e,n={},a=t.search.replace(/^\?/,"").split("&"),i=a.length,r=0;i>r;r++)a[r]&&(e=a[r].split("="),n[e[0]]=e[1]);return n}(),file:(t.pathname.match(/\/([^\/?#]+)$/i)||[,""])[1],hash:t.hash.replace("#",""),path:t.pathname.replace(/^([^\/])/,"/$1"),relative:(t.href.match(/tps?:\/\/[^\/]+(.+)/)||[,""])[1],segments:t.pathname.replace(/^\//,"").split("/")}}function MapConfiguration(){}function SuppressableLabel(e,t){this.text=e,this.displayOverride=void 0===t?LabellingStyleOverride.normal:t,this.suppress=this.displayOverride==LabellingStyleOverride.suppress,this.always=this.displayOverride==LabellingStyleOverride.always}function Location(e,t,n,a,i,r,o){this.x=e,this.z=t,this.type=n,this.labelOverride=SuppressableLabel.parse(a),this.hrefOverride=r,this.iconIndexOverride=o,this.owner=SuppressableLabel.parse(i)}function Rectangle(e,t,n,a){this.x1=Math.min(e,n),this.y1=Math.min(t,a),this.x2=Math.max(e,n),this.y2=Math.max(t,a),this.width=1+n-e,this.height=1+a-t}function SetDefaultSrc(e){isString(e)?gMapDataUriDefault=e:alert("SetDefaultSrc() was passed a non-string value")}function createLocationFromRow(e,t){var n,a=null;try{CSV.DETECT_TYPES=!1,CSV.TRIM_UNQUOTED_VALUES=!0,CSV.EXPAND_QUOTED_NEWLINES=!0,n=CSV.parse(t)[0]}catch(i){alert("Could not parse comma seperated values for entry/line "+e.toString()+": "+i)}var r=n[0];if("?"==r[r.length-1]&&(r=r.substring(0,r.length-1)),r in LocationType){var o=LocationType[r],s=parseInt(n[1]),h=parseInt(n[2]),l=parseInt(n[6]);isNaN(s)||isNaN(h)||(a=new Location(s,h,o,unquoteString(n[3]),unquoteString(n[4]),unquoteString(n[5]),l))}return a}function unquoteString(e){var t=e;if(isString(e)&&e.length>=2&&'"'==e[0]&&'"'==e[e.length-1]){var n=jQuery.parseJSON('{"value":'+e+"}");t=n.value}return t}function parseTextLocations(e,t){var n=new MapConfiguration,a=[],i=e.split("\n"),r=0;for(r=0;r<i.length;r++){var o=createLocationFromRow(r+1,i[r]);o instanceof Location?a.push(o):n.AssignFromRow(i[r])}t(n,a)}function parseHtmlLocations(e,t){function n(e){var t=e,n=trim(e),a=n.length>=2&&'"'==n[0]&&'"'==n[n.length-1];return a||(n.indexOf(",")>=0||n.indexOf('"')>=0)&&(t='"'+n.replace(/"/g,'""')+'"'),t}var a=new MapConfiguration,i=[],r=jQuery.parseHTML(e),o=0;$(r).find("tr").each(function(){var e="";o++,$(this).find("td").each(function(){e+=n(this.textContent)+","});var t=createLocationFromRow(o,e);t instanceof Location?i.push(t):a.AssignFromRow(e)}),o=0,$(r).find("ul, ol").each(function(){$(this).find("li").each(function(){o++;var e=createLocationFromRow(o,this.textContent);e instanceof Location?i.push(e):a.AssignFromRow(this.textContent)})}),t(a,i)}function createMapImageInDiv(e,t,n,a,i,r,o){var s=document.createElement("canvas");s.width=n,s.height=a;var h;h=e<i.HideLabelsAbove?LabellingStyle.none:e>=i.ShowLabelsBelow?LabellingStyle.all:LabellingStyle.smart,drawMapDetails(s,i,r,h);var l=CreateAreaMapInDiv(t,n,a,i,r),c=$(document.createElement("img")).css("display","block")[0],g=$.Deferred();c.onload=function(){g.resolve()},c.src=s.toDataURL("image/png"),c.useMap="#"+l;var d=document.getElementById(t);$(c).appendTo(d),$.when(g).done(o)}function CreateAreaMapInDiv(e,t,n,a,i){var r=e+"-areamap",o=t>n?t:n,s=a.GetXTranslationFunction(o),h=a.GetZTranslationFunction(o),l=document.createElement("map");l.name=r;var c;for(c=0;c<i.length;++c){var g=i[c],d=g.getHref(),m=!1,p=document.createElement("area");isEmpty(d)||(p.href=d,m=!0);var f=generateHtmlLabel(g,a.ShowCoordinates&&!a.DisableCoordinates);f.length>0&&($(p).mouseover(CreateHandler_mouseover(f)),$(p).mouseout(Handle_mouseout),m=!0),m&&(p.shape="circle",p.coords=[s(g.x),h(g.z),cClickRadius],p.alt=g.getAlt(),$(p).appendTo(l))}return $(l).appendTo(document.getElementById(e)),r}function CreateHandler_mouseover(e){return function(){$("#locationDesc").empty(),$("#locationDesc").append(e),$("#hoverFrame").removeClass("hidden-hoverFrame")}}function Handle_mouseout(){$("#hoverFrame").addClass("hidden-hoverFrame"),$("#locationDesc").empty()}function generateHtmlLabel(e,t){var n="",a=e.getLabel();isNotEmptyString(a)&&(a=strToHtml(trim(a)));var i=e.owner.text;isNotEmptyString(i)&&(i=strToHtml(trim(i)));var r=isNotEmptyString(i)?a.indexOf(i):-1,o='<span class="locationHoverOwner">'+i+"</span>",s=!0;if(isNotEmptyString(a)&&a!=i){var h=a;r>=0&&(h=a.substring(0,r)+o+a.substring(r+i.length),s=!1),h='<span class="locationHoverPlacename">'+h+"</span>",n=h,isNotEmptyString(i)&&s&&(n+="<br/>")}return isNotEmptyString(i)&&s&&(n+=o),isNotEmptyString(n)&&t&&(n+='<span class="locationHoverCoordinates"><br/>'+e.x+", "+e.z+"</span>"),isNotEmptyString(n)&&isNotEmptyString(e.getHref(!0))&&(n+='<div style="height: 11px"><img src="img/link.png" height="7" style="vertical-align: middle"></div>'),n}function strToHtml(e){return e.replace("\n"," ").replace("&","&amp;").replace("<","&lt;").replace(">","&gt;")}function drawMapDetails(e,t,n,a){function i(e){return e.split(/\r\n|\n|\r/)}function r(e,t,n){var a;"BoundsAtOrigin"in e?a=e.BoundsAtOrigin:(a=o(0,n,t,1),e.BoundsAtOrigin=a);var i,r=[];for(i=0;i<a.length;i++)r[i]=a[i].copy(w(e.x),v(e.z));return r}function o(e,t,n,a){var r=[];if(0>a||a>0||(a=0),!isEmpty(n)){var o,s=1,h=i(n);for(o=0;o<h.length;o++){var l=p.measureText(h[o]).width,c=p.measureText(trimLeft(h[o])).width,g=p.measureText(trimRight(h[o])).width,d=l-c,f=l-g,u=e-(l-1)/2,w=t+s;r[o]=new Rectangle(u+d-a,w-m-a,u+(l-1)-f+a,w+a),s+=m}}return r}function s(e,t,n){var a=0;if(!isEmpty(n)){var r,o=i(n);for(r=0;r<o.length;r++)p.fillText(o[r],e-p.measureText(o[r]).width/2,t+a),a+=m}}function h(e,t,n){var a=[];if(isNaN(e)||0>e);else{var i=IconBoundsInformation[e];void 0===i&&(i={width:20,height:20,yOffset:0});var r=t-i.width/2,o=n+i.yOffset-i.height/2;a[0]=new Rectangle(r,o,r+i.width-1,o+i.height-1)}return a}function l(e,t,n,a){!isNaN(e)&&e>=0&&(e>=cCustomIconIndexStart?gCustomIconsLoaded&&drawGlyph(p,gCustomIcons,e-cCustomIconIndexStart,t,n,a):drawGlyph(p,u,e,t,n,a))}function c(e,t){var n="",i=w(e.x),o=v(e.z);if(isEmpty(e.labelOverride.text)||e.labelOverride.suppress?isEmpty(e.owner.text)||e.owner.suppress||(n+=e.owner.text):n+=e.labelOverride.text,isEmpty(e.owner.text)||-1!=n.indexOf(e.owner.text)||e.owner.suppress||(n+="\n("+e.owner.text+")"),!isEmpty(n)&&t==S.Captions&&a!=LabellingStyle.none){var c=e.getIconIndex(),g=cTextOffset;(isNaN(c)||0>c)&&(g=3);var d=!0,m=e.labelOverride.always||e.owner.always;if(a==LabellingStyle.smart){var f,u=r(e,n,g);for(f=0;f<u.length;f++){var b,x=u[f];for(b=0;b<y.length;b++)if(x.intersects(y[b])){var I=h(e.getIconIndex(),i,o,0);if(0==I.length||!I[0].equals(y[b])){d=!1;break}}if(!d)break}(d||m)&&(y=y.concat(u))}if((d||m)&&s(i,o+g,n),cShowBoundingBoxes){p.lineWidth=1,p.strokeStyle="#0000FF";var b,C=r(e,n);for(b=0;b<C.length;b++)C[b].stroke(p)}}t==S.Masks&&l(e.getIconIndex(),!0,i,o),isEmpty(n)?t==S.UncaptionedIcons&&l(e.getIconIndex(),!1,i,o):t==S.CaptionedIcons&&l(e.getIconIndex(),!1,i,o)}function g(){var e=8,t=Math.round(w(0)),n=Math.round(v(0));p.lineWidth=2,p.strokeStyle="#6e5830",p.moveTo(t,n-e),p.lineTo(t,n+e),p.moveTo(t-e,n),p.lineTo(t+e,n),p.stroke()}function d(){var n=$("#map-background").width(),a=2*t.MapRange/n,i=Math.round(a).toString(),r=e.width/n,o=5,h=Math.round(6*r),l=Math.round(($("#map-background").height()-6)*r),c=Math.round(.4*r);p.lineWidth=2,p.strokeStyle="#6e5830",p.moveTo(h,l),p.lineTo(h+Math.round(r*o),l),p.lineTo(h+Math.round(r*o),l+c),p.moveTo(h,l-c),p.lineTo(h,l+c),p.moveTo(h+Math.round(r),l-c),p.lineTo(h+Math.round(r),l),p.stroke();var g=l-c-4,d=l+c+cTextOffset-4;s(h+r,g,i),s(h,d,"0"),s(h+r*o,d,Math.round(a*o).toString())}var m=10,p=e.getContext("2d"),f=e.width>e.height?e.width:e.height,u=document.getElementById("map-tileset"),w=t.GetXTranslationFunction(f),v=t.GetZTranslationFunction(f),y=[],S={Masks:0,Origin:1,Captions:2,UncaptionedIcons:3,CaptionedIcons:4,Scale:5,First:0,Last:5},b=document.getElementById("map-background");setCanvasScalingToPixelated(p),p.drawImage(b,0,0,e.width,e.height),p.lineWidth=1,p.strokeStyle="#FF00FF";var x;for(x=0;x<n.length;x++){var I=n[x],C=h(I.getIconIndex(),w(I.x),v(I.z),0);C.length>0&&(y[y.length]=C[0],cShowBoundingBoxes&&C[0].stroke(p))}p.font="10px Arial",p.font="10px 'Merienda', Arial, sans-serif";var O;for(O=S.First;O<=S.Last;O++)if(O==S.Origin)t.ShowOrigin&&g();else if(O==S.Scale)t.ShowScale&&d();else if(O==S.Captions){var M;for(M=0;M<n.length;M++)c(n[M],O)}else{var M;for(M=n.length-1;M>=0;M--)c(n[M],O)}}function setCanvasScalingToPixelated(e){e.mozImageSmoothingEnabled=!1,e.webkitImageSmoothingEnabled=!1,e.msImageSmoothingEnabled=!1,e.imageSmoothingEnabled=!1}function PreRender(e){var t=document.getElementById("oceanmask");if(null!==t){var n=document.getElementById("map-background"),a=renderOcean(e,n,t);n.src=a.toDataURL("image/png")}}function drawGlyph(e,t,n,a,i,r){var o=t.height/2,s=o/2;e.drawImage(t,n*o,a?o:0,o,o,i-s,r-s,o,o)}function renderOcean(e,t,n){if(0==n.width)return alert("Invalid ocean mask - width 0"),imageToCanvas(t);var a=n.width/2,i=n.height/2,r=Math.round(2*e.MapRange/cOceanBlocksPerPixel),o=Math.round(a+(e.X-e.MapRange)/cOceanBlocksPerPixel),s=Math.round(i+(e.Z-e.MapRange)/cOceanBlocksPerPixel),h=0>o?0:o,l=0>s?0:s,c=r-(h-o),g=r-(l-s);c=c>n.width?n.width:c,g=g>n.height?n.height:g;var d=t.width/r,m=Math.round((h-o)*d),p=Math.round((l-s)*d),f=Math.round(c*d),u=Math.round(g*d),w=f*cWorkingCanvasOversample,v=u*cWorkingCanvasOversample,y=document.createElement("canvas");y.width=w,y.height=v,workingContext=y.getContext("2d"),workingContext.drawImage(n,h,l,c,g,0,0,w,v);var S=e.OceanTheme.toLowerCase();return"darkseas"==S?renderTheme_DarkSeas(t,y,m,p,f,u):"coastalrelief"==S?renderTheme_CoastalRelief(t,y,m,p,f,u):renderTheme_BlueCoastline(t,y,m,p,f,u)}function renderTheme_BlueCoastline(e,t,n,a,i,r){var o=new RGB(127,130,146),s=new RGB(0,30,30),h=new RGB(243,226,194),l=new RGB(208,177,120),c=Math.round(204),g=Math.round(153),d=Math.round(51),m=cloneCanvas(t),p=Math.round(cWorkingCanvasOversample*e.width/8);stackBlurCanvasRGB(m,0,0,t.width,t.height,p);var f,u=t.width,w=t.height,v=t.getContext("2d"),y=m.getContext("2d").getImageData(0,0,m.width,m.height).data,S=v.getImageData(0,0,u,w),b=S.data,x=new Array(256),I=new Array(256),C=new Array(256);for(f=0;f<x.length;f++){var O=f/255;color=o.Blend(h,O),.5>=O&&(color=color.Blend(s,.5-O)),x[f]=color.R,I[f]=color.G,C[f]=color.B}var M=l.R,B=l.G,L=l.B,T=0,R=0,D=0;for(R=0;w>R;R++)for(T=0;u>T;T++){var E;if(b[D]>200)E=d,b[D]=M,b[D+1]=B,b[D+2]=L;else{var k=(255-y[D])/255;E=Math.round(c*(1-k)+g*k);var F=b[D]+Math.round(.7*(255-y[D]));F>255&&(O=255),b[D]=x[F],b[D+1]=I[F],b[D+2]=C[F]}b[D+3]=E,D+=4}v.putImageData(S,0,0);var N=cloneCanvas(e),A=N.getContext("2d");return A.drawImage(t,0,0,u,w,n,a,i,r),ApplyMapEdgesToCanvas(N,e,1,1)}function renderTheme_DarkSeas(e,t,n,a,i,r){var o=new RGB(144,104,67),s=new RGB(249,232,206),h=Math.round(178.5),l=Math.round(51),c=Math.round(63.75),g=cloneCanvas(t),d=Math.round(cWorkingCanvasOversample*e.width/8);stackBlurCanvasRGB(g,0,0,t.width,t.height,d);var m=t.width,p=t.height,f=t.getContext("2d"),u=g.getContext("2d").getImageData(0,0,g.width,g.height).data,w=f.getImageData(0,0,m,p),v=w.data,y=s.R,S=s.G,b=s.B,x=o.R,I=o.G,C=o.B,O=0,M=0,B=0;for(M=0;p>M;M++)for(O=0;m>O;O++){var L;v[B]>200?(L=c,v[B]=y,v[B+1]=S,v[B+2]=b):(L=Math.round(u[B]*(h-l)/255)+l,v[B]=x,v[B+1]=I,v[B+2]=C),v[B+3]=L,B+=4}f.putImageData(w,0,0);var T=cloneCanvas(e),R=T.getContext("2d");return R.drawImage(t,0,0,m,p,n,a,i,r),ApplyMapEdgesToCanvas(T,e,1,1)}function renderTheme_CoastalRelief(e,t,n,a,i,r){var o=new RGB(144,104,67),s=o.Blend(cColor_Black,.5),h=cloneCanvas(t),l=Math.round(cWorkingCanvasOversample*e.width/20);stackBlurCanvasRGB(h,0,0,t.width,t.height,l);var c=t.width,g=t.height,d=t.getContext("2d"),m=h.getContext("2d").getImageData(0,0,h.width,h.height).data,p=d.getImageData(0,0,c,g),f=p.data,u=s.R,w=s.G,v=s.B,y=0,S=0,b=0;for(S=0;g>S;S++)for(y=0;c>y;y++){var x=255-f[b],I=m[b];f[b]=u,f[b+1]=w,f[b+2]=v,f[b+3]=I>x?x:I,b+=4}d.putImageData(p,0,0);var C=cloneCanvas(e),O=C.getContext("2d");return O.drawImage(t,0,0,c,g,n,a,i,r),ApplyMapEdgesToCanvas(C,e,1,0)}function ApplyMapEdgesToCanvas(e,t,n,a,i){void 0===n&&(n=2),void 0===a&&(a=4),void 0===i&&(i=0);var r=cloneCanvas(t),o=r.getContext("2d"),s=o.getImageData(0,0,r.width,r.height),h=s.data,l=e.getContext("2d"),c=l.getImageData(0,0,e.width,e.height),g=c.data,d=new Array(r.width),m=0;for(m=0;m<d.length;m++)d[m]=255;for(m=0;n>m;m++)d[m]=i,d[d.length-(m+1)]=i;for(m=0;a>m;m++){var p=i+Math.round((255-i)*(m+1)/(a+1));d[m+n]=p,d[d.length-(m+1+n)]=p}var f,u,w,v=0,y=0,S=0,b=!1;for(y=0;y<r.height;y++){var x=d[y];for(v=0;v<r.width;v++){if(0==h[S+3])g[S+3]=0;else if(b)if(h[S]==f&&h[S+1]==u&&h[S+2]==w)g[S+3]=0;else{var I=d[v],C=x>I?I:x;g[S+3]=C}else b=!0,f=h[S],u=h[S+1],w=h[S+2],g[S+3]=0;S+=4}}return l.putImageData(c,0,0),o.drawImage(e,0,0),r}function RGB(e,t,n,a){this.R=e,this.G=t,this.B=n,this.A=void 0===a?255:a}function cloneCanvas(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var n=t.getContext("2d");return n.drawImage(e,0,0),t}function createMapsInDivs_Async(e,t,n,a){function i(a,i){return function(){createMapImageInDiv(a,n[a].divName,n[a].width,n[a].height,e,t,function(){i.resolve()})}}PreRender(e);var r,o=[];for(r=0;r<n.length;r++){var s=$.Deferred();setTimeout(i(r,s),1),o[r]=s}$.when.apply($,o).done(a)}function getSettingsAndMapLocations(e,t,n){function a(e){document.title=e.Title,$("#mainTitle").text(e.Title),$("#tagline").text(e.Blurb)}function i(e,t){if(isString(e)){var n=new RegExp(".txt$|.csv$","i"),a=n.test(e);$.ajax({url:e,dataType:a?"text":"html",success:function(e,n,i){var r=i.getResponseHeader("content-type")||"";r.indexOf("text/plain")>=0||r.indexOf("text/csv")>=0||a?parseTextLocations(e,t):parseHtmlLocations(e,t)},error:function(t,n,a){alert(e==gMapDataUriDefault?'no "src=" url was specified to scrape the location data from.\n\n(and could not load from the fallback url)':'Failed to load locations from src "'+e+'", something went wrong: '+n+", "+a)}})}else alert("Internal error: dataUrl not string")}var r=new MapConfiguration;r.AssignFromUrl(location);var o="MapDataUri"in r?r.MapDataUri:gMapDataUriDefault;isNotEmptyString(o)?i(o,function(i,o){var s=new MapConfiguration;s.SetDefaults(e,t),s.AssignFrom(i),s.AssignFrom(r),a(s),isEmpty(s.CustomIconsUri)?n(s,o):($(gCustomIcons).bind({load:function(){gCustomIconsLoaded=!0,n(s,o)},error:function(){n(s,o)}}),gCustomIcons.src=s.CustomIconsUri)}):1!=r.Abort&&alert('no "src=" url was specified to scrape the location data from.')}var cMapRangeDefault=3200,cClickRadius=12,cTextOffset=14,cLabel_DontDrawChar="~",cLabel_AlwaysDrawChar="!",cCustomIconIndexStart=64,cShowBoundingBoxes=!1,gMapDataUriDefault="",gCustomIcons=new Image,gCustomIconsLoaded=!1,LocationType={Village:{iconIndex:0,name:"Plains Village",href:"http://minecraft.gamepedia.com/Village#Plains"},DesertVillage:{iconIndex:1,name:"Desert village",href:"http://minecraft.gamepedia.com/Village#Desert"},SavannahVillage:{iconIndex:0,name:"Savannah village",href:"http://minecraft.gamepedia.com/Village#Savannah"},WitchHut:{iconIndex:3,name:"Witch's hut",href:"http://minecraft.gamepedia.com/Generated_structures#Witch_Huts"},JungleTemple:{iconIndex:4,name:"Jungle temple",href:"http://minecraft.gamepedia.com/Jungle_temple"},DesertTemple:{iconIndex:5,name:"Desert temple",href:"http://minecraft.gamepedia.com/Desert_temple"},NetherFortress:{iconIndex:6,name:"Nether Fortress",href:"http://minecraft.gamepedia.com/Nether_Fortress"},NetherPortal:{iconIndex:7,name:"Portal",href:"http://minecraft.gamepedia.com/Nether_Portal"},Forest:{iconIndex:28,name:"Forest",href:"http://minecraft.gamepedia.com/Biome#Forest"},FlowerForest:{iconIndex:26,name:"Flower forest",href:"http://minecraft.gamepedia.com/Flower_forest"},MushroomIsland:{iconIndex:29,name:"Mushroom island",href:"http://minecraft.gamepedia.com/Mushroom_Island"},Horse:{iconIndex:34,name:"",href:"http://minecraft.gamepedia.com/Horse"},Wolf:{iconIndex:35,name:"",href:"http://minecraft.gamepedia.com/Wolf"},Dragon:{iconIndex:36,name:"",href:""},SeaMonster:{iconIndex:45,name:"",href:""},Ship:{iconIndex:38,name:"",href:""},Spawn:{iconIndex:40,name:"Spawn",href:""},PlayerStructure:{iconIndex:8,name:"",href:""},PlayerCastle:{iconIndex:9,name:"",href:""},PlayerHouse:{iconIndex:10,name:"",href:""},PlayerFarm:{iconIndex:14,name:"Farm",href:""},PlayerMachine:{iconIndex:12,name:"",href:""},EnchantingRoom:{iconIndex:44,name:"",href:"http://minecraft.gamepedia.com/Enchantment_Table"},Label:{iconIndex:-1,name:"",href:""},FenceOverlay:{iconIndex:13,name:"",href:""},IslandOverlay:{iconIndex:30,name:"",href:""}},LabellingStyle={none:0,smart:1,all:2},LabellingStyleOverride={normal:0,suppress:1,always:2},IconBoundsInformation={0:{width:14,height:16,yOffset:-1},1:{width:14,height:16,yOffset:-1},2:{width:12,height:20,yOffset:0},3:{width:14,height:20,yOffset:-5},4:{width:16,height:17,yOffset:-2},5:{width:10,height:17,yOffset:0},6:{width:10,height:14,yOffset:-2},7:{width:10,height:13,yOffset:-1},8:{width:10,height:10,yOffset:0},9:{width:10,height:14,yOffset:-2},10:{width:12,height:11,yOffset:-1},11:{width:15,height:8,yOffset:0},12:{width:10,height:16,yOffset:-4},13:{width:0,height:0,yOffset:-8},14:{width:16,height:16,yOffset:-1},15:{width:12,height:13,yOffset:0},16:{width:10,height:10,yOffset:0},17:{width:10,height:10,yOffset:0},18:{width:10,height:10,yOffset:0},19:{width:12,height:12,yOffset:0},20:{width:16,height:16,yOffset:0},21:{width:4,height:18,yOffset:0},22:{width:14,height:24,yOffset:-4},23:{width:15,height:16,yOffset:-1},24:{width:15,height:16,yOffset:-1},25:{width:15,height:16,yOffset:-1},26:{width:14,height:14,yOffset:-1},27:{width:20,height:18,yOffset:-3},28:{width:24,height:22,yOffset:-4},29:{width:17,height:16,yOffset:-2},30:{width:0,height:0,yOffset:-8},31:{width:30,height:18,yOffset:0},32:{width:30,height:20,yOffset:-1},33:{width:18,height:16,yOffset:-1},34:{width:18,height:17,yOffset:0},35:{width:17,height:13,yOffset:0},36:{width:30,height:28,yOffset:1},37:{width:27,height:27,yOffset:1},38:{width:29,height:30,yOffset:0},39:{width:20,height:27,yOffset:-2},40:{width:14,height:12,yOffset:0},41:{width:18,height:16,yOffset:0},42:{width:14,height:22,yOffset:-4},43:{width:14,height:16,yOffset:-1},44:{width:14,height:16,yOffset:-1},45:{width:28,height:16,yOffset:1}};MapConfiguration.prototype.SetDefaults=function(){var e=0;"HideLabelsAbove"in this||(this.HideLabelsAbove=e),"ShowLabelsBelow"in this||(this.ShowLabelsBelow=3),"MapRange"in this||(this.MapRange=cMapRangeDefault),"Title"in this||(this.Title="Map of the Overworld"),"Blurb"in this||(this.Blurb="Use up/down or mousewheel to zoom, drag to scroll"),"CustomIconsUri"in this||(this.CustomIconsUri=""),"X"in this||(this.X=0),"Z"in this||(this.Z=0),"ShowOrigin"in this||(this.ShowOrigin=!0),"ShowScale"in this||(this.ShowScale=!0),"ShowCoordinates"in this||(this.ShowCoordinates=!1),"DisableCoordinates"in this||(this.DisableCoordinates=!1),"OceanTheme"in this||(this.OceanTheme="BlueCoastline")},MapConfiguration.prototype.AssignFrom=function(e){"MapDataUri"in e&&(this.MapDataUri=e.MapDataUri),"HideLabelsAbove"in e&&(this.HideLabelsAbove=e.HideLabelsAbove),"ShowLabelsBelow"in e&&(this.ShowLabelsBelow=e.ShowLabelsBelow),"MapRange"in e&&(this.MapRange=e.MapRange),"Title"in e&&(this.Title=e.Title),"Blurb"in e&&(this.Blurb=e.Blurb),"CustomIconsUri"in e&&(this.CustomIconsUri=e.CustomIconsUri),"X"in e&&(this.X=e.X),"Z"in e&&(this.Z=e.Z),"ShowOrigin"in e&&(this.ShowOrigin=e.ShowOrigin),"ShowScale"in e&&(this.ShowScale=e.ShowScale),"ShowCoordinates"in e&&(this.ShowCoordinates=e.ShowCoordinates),"DisableCoordinates"in e&&(this.DisableCoordinates=e.DisableCoordinates),"OceanTheme"in e&&(this.OceanTheme=e.OceanTheme)},MapConfiguration.prototype.AssignFromRow=function(e){var t=e.indexOf("=");if(t>0){var n=trim(e.substring(0,t)).toLowerCase(),a=trim(e.slice(t+1));if("z"==n){var i=parseInt(a);isNaN(i)||(this.Z=i)}if("x"==n){var r=parseInt(a);isNaN(r)||(this.X=r)}if("hidelabelsabove"==n){var o=parseInt(a);isNaN(o)||(this.HideLabelsAbove=o)}if("showlabelsbelow"==n){var s=parseInt(a);isNaN(s)||(this.ShowLabelsBelow=s)}if("range"==n){var h=parseInt(a);isNaN(h)||(this.MapRange=h)}"title"==n&&isString(a)&&(this.Title=unquoteString(a)),"blurb"==n&&isString(a)&&(this.Blurb=unquoteString(a)),"icons"==n&&isString(a)&&(this.CustomIconsUri=unquoteString(a)),"googleicons"==n&&isString(a)&&(this.CustomIconsUri="https://googledrive.com/host/"+unquoteString(a)),"showorigin"==n&&isString(a)&&(this.ShowOrigin=stringToBool(a)),"showscale"==n&&isString(a)&&(this.ShowScale=stringToBool(a)),"showcoordinates"==n&&isString(a)&&(this.ShowCoordinates=stringToBool(a)),"disablecoordinates"==n&&isString(a)&&(this.DisableCoordinates=stringToBool(a)),"oceantheme"==n&&isString(a)&&(this.OceanTheme=unquoteString(a))}},MapConfiguration.prototype.AssignFromUrl=function(e){var t=parseURL(e);if(void 0!==Object.keys&&0==Object.keys(t.params).length&&location.host.indexOf("googledrive.com")>20&&(alert('no "src=" url was specified to scrape the location data from.\n\n(On the off-chance you did specify a src parameter and it\'s gone, then Google Drive could be experiencing problems again:\nSee http://buildingwithblocks.info/googlebug for more details)'),this.Abort=!0),"hidelabelsabove"in t.params&&(this.HideLabelsAbove=t.params.hidelabelsabove),"showlabelsbelow"in t.params&&(this.ShowLabelsBelow=t.params.showlabelsbelow),"range"in t.params&&(this.MapRange=t.params.range),"title"in t.params&&isString(t.params.title)&&(this.Title=decodeURIComponent(t.params.title.replace(/\+/g," "))),"blurb"in t.params&&isString(t.params.blurb)&&(this.Blurb=decodeURIComponent(t.params.blurb.replace(/\+/g," "))),"x"in t.params){var n=parseInt(t.params.x);isNaN(n)||(this.X=n)}if("z"in t.params){var a=parseInt(t.params.z);isNaN(a)||(this.Z=a)}"hideorigin"in t.params&&(this.ShowOrigin=!1),"hidescale"in t.params&&(this.ShowScale=!1),"showorigin"in t.params&&isString(t.params.showorigin)&&(this.ShowOrigin=stringToBool(t.params.showorigin)),"showscale"in t.params&&isString(t.params.showscale)&&(this.ShowScale=stringToBool(t.params.showscale)),"showcoordinates"in t.params&&isString(t.params.showcoordinates)&&(this.ShowCoordinates=stringToBool(t.params.showcoordinates)),"src"in t.params&&isString(t.params.src)&&(this.MapDataUri=decodeURIComponent(t.params.src)),"icons"in t.params&&isString(t.params.icons)&&(this.CustomIconsUri=t.params.icons),"googlesrc"in t.params&&isString(t.params.googlesrc)&&(this.MapDataUri=0==t.params.googlesrc.toLowerCase().indexOf("http")?t.params.googlesrc:"https://googledrive.com/host/"+t.params.googlesrc),"googleicons"in t.params&&isString(t.params.googleicons)&&(this.CustomIconsUri="https://googledrive.com/host/"+t.params.googleicons),"oceantheme"in t.params&&isString(t.params.oceantheme)&&(this.OceanTheme=t.params.oceantheme)},MapConfiguration.prototype.GetXTranslationFunction=function(e){var t=e/2,n=this.X,a=this.MapRange;return function(e){return(e-n)*t/a+t}},MapConfiguration.prototype.GetZTranslationFunction=function(e){var t=e/2,n=this.Z,a=this.MapRange;return function(e){return(e-n)*t/a+t}},SuppressableLabel.prototype.toString=function(){return this.text},SuppressableLabel.parse=function(e){var t=new SuppressableLabel(e);if(isString(e)){var n=trim(e);n.length>=2&&(n[0]==cLabel_DontDrawChar&&n[n.length-1]==cLabel_DontDrawChar?t=new SuppressableLabel(n.substring(1,n.length-1),LabellingStyleOverride.suppress):n[0]==cLabel_AlwaysDrawChar&&n[n.length-1]==cLabel_AlwaysDrawChar&&(t=new SuppressableLabel(n.substring(1,n.length-1),LabellingStyleOverride.always)))}return t},Location.prototype.getHref=function(e){return"-"==this.hrefOverride?"":isEmpty(this.hrefOverride)&&1!=e?this.type.href:this.hrefOverride},Location.prototype.getLabel=function(){return isEmpty(this.labelOverride.text)?this.type.name:this.labelOverride.text},Location.prototype.getIconIndex=function(){return isNaN(this.iconIndexOverride)||this.iconIndexOverride<0?this.type.iconIndex:this.iconIndexOverride},Location.prototype.getAlt=function(){var e=this.getLabel();return isEmpty(e)&&!isEmpty(this.owner.text)&&(e=this.owner.text),e},Rectangle.prototype.stroke=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=0),e.strokeRect(this.x1+t,this.y1+n,this.width,this.height)},Rectangle.prototype.copy=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=0),new Rectangle(this.x1+e,this.y1+t,this.x2+e,this.y2+t)},Rectangle.prototype.intersects=function(e){return this.x2>e.x1&&this.x1<e.x2&&this.y2>e.y1&&this.y1<e.y2},Rectangle.prototype.equals=function(e){return this.x1==e.x1&&this.y1==e.y1&&this.x2==e.x2&&this.y2==e.y2};var cOceanBlocksPerPixel=16,cWorkingCanvasOversample=4,cColor_Black=new RGB(0,0,0),cColor_White=new RGB(255,255,255);RGB.prototype.Blend=function(e,t){t=0>t?0:t>1?1:t;var n=1-t;return new RGB(Math.round(e.R*t+this.R*n),Math.round(e.G*t+this.G*n),Math.round(e.B*t+this.B*n))},RGB.prototype.MatchesRGB=function(e,t,n){return e==this.R&&t==this.G&&n==this.B},RGB.prototype.Matches=function(e){return e instanceof RGB&&e.R==this.R&&e.G==this.G&&e.B==this.B};