/**** @Preserve
 v1.7

 Copyright 2014 Glenn Fisher

 This is an unofficial mapping system for Minecraft. It is neither produced nor 
 endorsed by Mojang.

 Licenced under GPL licence, version 3 or later
 https://www.gnu.org/copyleft/gpl.html

 Note that other files in this project have their own licence, see \licence.md
*****/
function isEmpty(e){return!e||0===e.length}function isString(e){return"string"==typeof e||e instanceof String}function isNotEmptyString(e){return("string"==typeof e||e instanceof String)&&e.length>0}function isFunction(e){return"function"==typeof e}function stringToBool(e){switch(trim(e).toLowerCase()){case"true":case"on":case"yes":case"1":return!0;case"false":case"off":case"no":case"0":case null:return!1;default:return Boolean(string)}}function imageToCanvas(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t}function trimRight(e){return isFunction(e.trimRight)?e.trimRight():e.replace(/\s+$/,"")}function trimLeft(e){return isFunction(e.trimLeft)?e.trimLeft():e.replace(/^\s+/,"")}function trim(e){return isFunction(e.trim)?e.trim():e.replace(/^\s+|\s+$/g,"")}function parseURL(e){var t=document.createElement("a");return t.href=e,{source:e,protocol:t.protocol.replace(":",""),host:t.hostname,port:t.port,query:t.search,params:function(){for(var e,i={},n=t.search.replace(/^\?/,"").split("&"),a=n.length,r=0;a>r;r++)n[r]&&(e=n[r].split("="),i[e[0]]=e[1]);return i}(),file:(t.pathname.match(/\/([^\/?#]+)$/i)||[,""])[1],hash:t.hash.replace("#",""),path:t.pathname.replace(/^([^\/])/,"/$1"),relative:(t.href.match(/tps?:\/\/[^\/]+(.+)/)||[,""])[1],segments:t.pathname.replace(/^\//,"").split("/")}}function MapConfiguration(){}function SuppressableLabel(e,t){this.text=e,this.displayOverride=void 0===t?LabellingStyleOverride.normal:t,this.suppress=this.displayOverride==LabellingStyleOverride.suppress,this.always=this.displayOverride==LabellingStyleOverride.always}function Location(e,t,i,n,a,r,o){this.x=e,this.z=t,this.type=i,this.labelOverride=SuppressableLabel.parse(n),this.hrefOverride=r,this.iconIndexOverride=o,this.owner=SuppressableLabel.parse(a)}function Rectangle(e,t,i,n){this.x1=Math.min(e,i),this.y1=Math.min(t,n),this.x2=Math.max(e,i),this.y2=Math.max(t,n),this.width=1+i-e,this.height=1+n-t}function SetDefaultSrc(e){isString(e)?gMapDataUriDefault=e:alert("SetDefaultSrc() was passed a non-string value")}function createLocationFromRow(e,t){var i,n=null;try{CSV.DETECT_TYPES=!1,CSV.TRIM_UNQUOTED_VALUES=!0,CSV.EXPAND_QUOTED_NEWLINES=!0,i=CSV.parse(t)[0]}catch(a){alert("Could not parse comma seperated values for entry/line "+e.toString()+": "+a)}var r=i[0];if("?"==r[r.length-1]&&(r=r.substring(0,r.length-1)),r in LocationType){var o=LocationType[r],s=parseInt(i[1]),h=parseInt(i[2]),l=parseInt(i[6]);isNaN(s)||isNaN(h)||(n=new Location(s,h,o,unquoteString(i[3]),unquoteString(i[4]),unquoteString(i[5]),l))}return n}function unquoteString(e){var t=e;if(isString(e)&&e.length>=2&&'"'==e[0]&&'"'==e[e.length-1]){var i=jQuery.parseJSON('{"value":'+e+"}");t=i.value}return t}function parseTextLocations(e,t){var i=new MapConfiguration,n=[],a=e.split("\n"),r=0;for(r=0;r<a.length;r++){var o=createLocationFromRow(r+1,a[r]);o instanceof Location?n.push(o):i.AssignFromRow(a[r])}t(i,n)}function parseHtmlLocations(e,t){function i(e){var t=e,i=trim(e),n=i.length>=2&&'"'==i[0]&&'"'==i[i.length-1];return n||(i.indexOf(",")>=0||i.indexOf('"')>=0)&&(t='"'+i.replace(/"/g,'""')+'"'),t}var n=new MapConfiguration,a=[],r=jQuery.parseHTML(e),o=0;$(r).find("tr").each(function(){var e="";o++,$(this).find("td").each(function(){e+=i(this.textContent)+","});var t=createLocationFromRow(o,e);t instanceof Location?a.push(t):n.AssignFromRow(e)}),o=0,$(r).find("ul, ol").each(function(){$(this).find("li").each(function(){o++;var e=createLocationFromRow(o,this.textContent);e instanceof Location?a.push(e):n.AssignFromRow(this.textContent)})}),t(n,a)}function createMapImageInDiv(e,t,i,n,a,r,o){var s=document.createElement("canvas");s.width=i,s.height=n;var h;h=e<a.HideLabelsAbove?LabellingStyle.none:e>=a.ShowLabelsBelow?LabellingStyle.all:LabellingStyle.smart,drawMapDetails(s,a,r,h);var l=CreateAreaMapInDiv(t,i,n,a,r),c=$(document.createElement("img")).css("display","block")[0],g=$.Deferred();c.onload=function(){g.resolve()},c.src=s.toDataURL("image/png"),c.useMap="#"+l;var d=document.getElementById(t);$(c).appendTo(d),$.when(g).done(o)}function CreateAreaMapInDiv(e,t,i,n,a){var r=e+"-areamap",o=t>i?t:i,s=n.GetXTranslationFunction(o),h=n.GetZTranslationFunction(o),l=document.createElement("map");l.name=r;var c;for(c=0;c<a.length;++c){var g=a[c],d=g.getHref(),p=!1,m=document.createElement("area");isEmpty(d)||(m.href=d,p=!0);var f=generateHtmlLabel(g,n.ShowCoordinates&&!n.DisableCoordinates);f.length>0&&($(m).mouseover(CreateHandler_mouseover(f)),$(m).mouseout(Handle_mouseout),p=!0),p&&(m.shape="circle",m.coords=[s(g.x),h(g.z),cClickRadius],m.alt=g.getAlt(),$(m).appendTo(l))}return $(l).appendTo(document.getElementById(e)),r}function CreateHandler_mouseover(e){return function(){$("#locationDesc").empty(),$("#locationDesc").append(e),$("#hoverFrame").removeClass("hidden-hoverFrame")}}function Handle_mouseout(){$("#hoverFrame").addClass("hidden-hoverFrame"),$("#locationDesc").empty()}function generateHtmlLabel(e,t){var i="",n=e.getLabel();isNotEmptyString(n)&&(n=strToHtml(trim(n)));var a=e.owner.text;isNotEmptyString(a)&&(a=strToHtml(trim(a)));var r=isNotEmptyString(a)?n.indexOf(a):-1,o='<span class="locationHoverOwner">'+a+"</span>",s=!0;if(isNotEmptyString(n)&&n!=a){var h=n;r>=0&&(h=n.substring(0,r)+o+n.substring(r+a.length),s=!1),h='<span class="locationHoverPlacename">'+h+"</span>",i=h,isNotEmptyString(a)&&s&&(i+="<br/>")}return isNotEmptyString(a)&&s&&(i+=o),isNotEmptyString(i)&&t&&(i+='<span class="locationHoverCoordinates"><br/>'+e.x+", "+e.z+"</span>"),isNotEmptyString(i)&&isNotEmptyString(e.getHref(!0))&&(i+='<div style="height: 11px"><img src="img/link.png" height="7" style="vertical-align: middle"></div>'),i}function strToHtml(e){return e.replace("\n"," ").replace("&","&amp;").replace("<","&lt;").replace(">","&gt;")}function drawMapDetails(e,t,i,n){function a(e){return e.split(/\r\n|\n|\r/)}function r(e,t,i){var n;"BoundsAtOrigin"in e?n=e.BoundsAtOrigin:(n=o(0,i,t,1),e.BoundsAtOrigin=n);var a,r=[];for(a=0;a<n.length;a++)r[a]=n[a].copy(w(e.x),v(e.z));return r}function o(e,t,i,n){var r=[];if(0>n||n>0||(n=0),!isEmpty(i)){var o,s=1,h=a(i);for(o=0;o<h.length;o++){var l=m.measureText(h[o]).width,c=m.measureText(trimLeft(h[o])).width,g=m.measureText(trimRight(h[o])).width,d=l-c,f=l-g,u=e-(l-1)/2,w=t+s;r[o]=new Rectangle(u+d-n,w-p-n,u+(l-1)-f+n,w+n),s+=p}}return r}function s(e,t,i){var n=0;if(!isEmpty(i)){var r,o=a(i);for(r=0;r<o.length;r++)m.fillText(o[r],e-m.measureText(o[r]).width/2,t+n),n+=p}}function h(e,t,i){var n=[];if(isNaN(e)||0>e);else{var a=IconBoundsInformation[e];void 0===a&&(a={width:20,height:20,yOffset:0});var r=t-a.width/2,o=i+a.yOffset-a.height/2;n[0]=new Rectangle(r,o,r+a.width-1,o+a.height-1)}return n}function l(e,t,i,n){!isNaN(e)&&e>=0&&(e>=cCustomIconIndexStart?gCustomIconsLoaded&&drawGlyph(m,gCustomIcons,e-cCustomIconIndexStart,t,i,n):drawGlyph(m,u,e,t,i,n))}function c(e,t){var i="",a=w(e.x),o=v(e.z);if(isEmpty(e.labelOverride.text)||e.labelOverride.suppress?isEmpty(e.owner.text)||e.owner.suppress||(i+=e.owner.text):i+=e.labelOverride.text,isEmpty(e.owner.text)||-1!=i.indexOf(e.owner.text)||e.owner.suppress||(i+="\n("+e.owner.text+")"),!isEmpty(i)&&t==S.Captions&&n!=LabellingStyle.none){var c=e.getIconIndex(),g=cTextOffset;(isNaN(c)||0>c)&&(g=3);var d=!0,p=e.labelOverride.always||e.owner.always;if(n==LabellingStyle.smart){var f,u=r(e,i,g);for(f=0;f<u.length;f++){var b,x=u[f];for(b=0;b<y.length;b++)if(x.intersects(y[b])){var I=h(e.getIconIndex(),a,o,0);if(0==I.length||!I[0].equals(y[b])){d=!1;break}}if(!d)break}(d||p)&&(y=y.concat(u))}if((d||p)&&s(a,o+g,i),cShowBoundingBoxes){m.lineWidth=1,m.strokeStyle="#0000FF";var b,O=r(e,i);for(b=0;b<O.length;b++)O[b].stroke(m)}}t==S.Masks&&l(e.getIconIndex(),!0,a,o),isEmpty(i)?t==S.UncaptionedIcons&&l(e.getIconIndex(),!1,a,o):t==S.CaptionedIcons&&l(e.getIconIndex(),!1,a,o)}function g(){var e=8,t=Math.round(w(0)),i=Math.round(v(0));m.lineWidth=2,m.strokeStyle="#6e5830",m.moveTo(t,i-e),m.lineTo(t,i+e),m.moveTo(t-e,i),m.lineTo(t+e,i),m.stroke()}function d(){var i=$("#map-background").width(),n=2*t.MapRange/i,a=Math.round(n).toString(),r=e.width/i,o=5,h=Math.round(6*r),l=Math.round(($("#map-background").height()-6)*r),c=Math.round(.4*r);m.lineWidth=2,m.strokeStyle="#6e5830",m.moveTo(h,l),m.lineTo(h+Math.round(r*o),l),m.lineTo(h+Math.round(r*o),l+c),m.moveTo(h,l-c),m.lineTo(h,l+c),m.moveTo(h+Math.round(r),l-c),m.lineTo(h+Math.round(r),l),m.stroke();var g=l-c-4,d=l+c+cTextOffset-4;s(h+r,g,a),s(h,d,"0"),s(h+r*o,d,Math.round(n*o).toString())}var p=10,m=e.getContext("2d"),f=e.width>e.height?e.width:e.height,u=document.getElementById("map-tileset"),w=t.GetXTranslationFunction(f),v=t.GetZTranslationFunction(f),y=[],S={Masks:0,Origin:1,Captions:2,UncaptionedIcons:3,CaptionedIcons:4,Scale:5,First:0,Last:5},b=document.getElementById("map-background");setCanvasScalingToPixelated(m),m.drawImage(b,0,0,e.width,e.height),m.lineWidth=1,m.strokeStyle="#FF00FF";var x;for(x=0;x<i.length;x++){var I=i[x],O=h(I.getIconIndex(),w(I.x),v(I.z),0);O.length>0&&(y[y.length]=O[0],cShowBoundingBoxes&&O[0].stroke(m))}m.font="10px Arial",m.font="10px 'Merienda', Arial, sans-serif";var C;for(C=S.First;C<=S.Last;C++)if(C==S.Origin)t.ShowOrigin&&g();else if(C==S.Scale)t.ShowScale&&d();else if(C==S.Captions){var M;for(M=0;M<i.length;M++)c(i[M],C)}else{var M;for(M=i.length-1;M>=0;M--)c(i[M],C)}}function setCanvasScalingToPixelated(e){e.mozImageSmoothingEnabled=!1,e.webkitImageSmoothingEnabled=!1,e.msImageSmoothingEnabled=!1,e.imageSmoothingEnabled=!1}function PreRender(e){var t=document.getElementById("oceanmask");if(null!==t){var i=document.getElementById("map-background"),n=renderOcean(e,i,t);i.src=n.toDataURL("image/png")}}function drawGlyph(e,t,i,n,a,r){var o=t.height/2,s=o/2;e.drawImage(t,i*o,n?o:0,o,o,a-s,r-s,o,o)}function renderOcean(e,t,i){if(0==i.width)return alert("Invalid ocean mask - width 0"),imageToCanvas(t);var n=i.width/2,a=i.height/2,r=Math.round(2*e.MapRange/cOceanBlocksPerPixel),o=Math.round(n+(e.X-e.MapRange)/cOceanBlocksPerPixel),s=Math.round(a+(e.Z-e.MapRange)/cOceanBlocksPerPixel),h=0>o?0:o,l=0>s?0:s,c=r-(h-o),g=r-(l-s);c=c>i.width?i.width:c,g=g>i.height?i.height:g;var d=t.width/r,p=Math.round((h-o)*d),m=Math.round((l-s)*d),f=Math.round(c*d),u=Math.round(g*d),w=f*cWorkingCanvasOversample,v=u*cWorkingCanvasOversample,y=document.createElement("canvas");return y.width=w,y.height=v,workingContext=y.getContext("2d"),workingContext.drawImage(i,h,l,c,g,0,0,w,v),renderTheme_BlueCoastline(t,y,p,m,f,u)}function renderTheme_BlueCoastline(e,t,i,n,a,r){var o=new RGB(127,130,146),s=new RGB(0,30,30),h=new RGB(243,226,194),l=new RGB(208,177,120),c=Math.round(168.3),g=Math.round(51),d=cloneCanvas(t),p=Math.round(cWorkingCanvasOversample*e.width/8);stackBlurCanvasRGB(d,0,0,t.width,t.height,p);var m=t.width,f=t.height,u=t.getContext("2d"),w=d.getContext("2d").getImageData(0,0,d.width,d.height).data,v=u.getImageData(0,0,m,f),y=v.data,S=0,b=0,x=0;for(b=0;f>b;b++)for(S=0;m>S;S++){var I,O;if(255==y[x])O=g,I=l;else{O=c;var C=y[x]+Math.round(.7*(255-w[x]));C>255?C=1:C/=255,I=o.Blend(h,C),.5>=C&&(I=I.Blend(s,.5-C))}y[x]=I.R,y[x+1]=I.G,y[x+2]=I.B,y[x+3]=O,x+=4}u.putImageData(v,0,0);var M=cloneCanvas(e),L=M.getContext("2d");return L.drawImage(t,0,0,m,f,i,n,a,r),ApplyMapEdgesToCanvas(M,e,2,2)}function ApplyMapEdgesToCanvas(e,t,i,n,a){void 0===i&&(i=2),void 0===n&&(n=4),void 0===a&&(a=0);var r=cloneCanvas(t),o=r.getContext("2d"),s=o.getImageData(0,0,r.width,r.height),h=s.data,l=e.getContext("2d"),c=l.getImageData(0,0,e.width,e.height),g=c.data,d=new Array(r.width),p=0;for(p=0;p<d.length;p++)d[p]=255;for(p=0;i>p;p++)d[p]=a,d[d.length-(p+1)]=a;for(p=0;n>p;p++){var m=a+Math.round((255-a)*(p+1)/(n+1));d[p+i]=m,d[d.length-(p+1+i)]=m}var f=0,u=0,w=0,v=void 0;for(u=0;u<r.height;u++){var y=d[u];for(f=0;f<r.width;f++){var S=new RGB(h[w],h[w+1],h[w+2],h[w+3]);if(0==S.A||S.Matches(v))g[w+3]=0;else{void 0===v&&(v=S);var b=d[f],x=y>b?b:y;g[w+3]=x}w+=4}}return l.putImageData(c,0,0),o.drawImage(e,0,0),r}function RGB(e,t,i,n){this.R=e,this.G=t,this.B=i,this.A=void 0===n?255:n}function cloneCanvas(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var i=t.getContext("2d");return i.drawImage(e,0,0),t}function createMapsInDivs_Async(e,t,i,n){function a(n,a){return function(){createMapImageInDiv(n,i[n].divName,i[n].width,i[n].height,e,t,function(){a.resolve()})}}PreRender(e);var r,o=[];for(r=0;r<i.length;r++){var s=$.Deferred();setTimeout(a(r,s),1),o[r]=s}$.when.apply($,o).done(n)}function getSettingsAndMapLocations(e,t,i){function n(e){document.title=e.Title,$("#mainTitle").text(e.Title),$("#tagline").text(e.Blurb)}function a(e,t){if(isString(e)){var i=new RegExp(".txt$|.csv$","i"),n=i.test(e);$.ajax({url:e,dataType:n?"text":"html",success:function(e,i,a){var r=a.getResponseHeader("content-type")||"";r.indexOf("text/plain")>=0||r.indexOf("text/csv")>=0||n?parseTextLocations(e,t):parseHtmlLocations(e,t)},error:function(t,i,n){alert(e==gMapDataUriDefault?'no "src=" url was specified to scrape the location data from.\n\n(and could not load from the fallback url)':'Failed to load locations from src "'+e+'", something went wrong: '+i+", "+n)}})}else alert("Internal error: dataUrl not string")}var r=new MapConfiguration;r.AssignFromUrl(location);var o="MapDataUri"in r?r.MapDataUri:gMapDataUriDefault;isNotEmptyString(o)?a(o,function(a,o){var s=new MapConfiguration;s.SetDefaults(e,t),s.AssignFrom(a),s.AssignFrom(r),n(s),isEmpty(s.CustomIconsUri)?i(s,o):($(gCustomIcons).bind({load:function(){gCustomIconsLoaded=!0,i(s,o)},error:function(){i(s,o)}}),gCustomIcons.src=s.CustomIconsUri)}):1!=r.Abort&&alert('no "src=" url was specified to scrape the location data from.')}var cMapRangeDefault=3200,cClickRadius=12,cTextOffset=14,cLabel_DontDrawChar="~",cLabel_AlwaysDrawChar="!",cCustomIconIndexStart=64,cShowBoundingBoxes=!1,gMapDataUriDefault="",gCustomIcons=new Image,gCustomIconsLoaded=!1,LocationType={Village:{iconIndex:0,name:"Plains Village",href:"http://minecraft.gamepedia.com/Village#Plains"},DesertVillage:{iconIndex:1,name:"Desert village",href:"http://minecraft.gamepedia.com/Village#Desert"},SavannahVillage:{iconIndex:0,name:"Savannah village",href:"http://minecraft.gamepedia.com/Village#Savannah"},WitchHut:{iconIndex:3,name:"Witch's hut",href:"http://minecraft.gamepedia.com/Generated_structures#Witch_Huts"},JungleTemple:{iconIndex:4,name:"Jungle temple",href:"http://minecraft.gamepedia.com/Jungle_temple"},DesertTemple:{iconIndex:5,name:"Desert temple",href:"http://minecraft.gamepedia.com/Desert_temple"},NetherFortress:{iconIndex:6,name:"Nether Fortress",href:"http://minecraft.gamepedia.com/Nether_Fortress"},NetherPortal:{iconIndex:7,name:"Portal",href:"http://minecraft.gamepedia.com/Nether_Portal"},Forest:{iconIndex:28,name:"Forest",href:"http://minecraft.gamepedia.com/Biome#Forest"},FlowerForest:{iconIndex:26,name:"Flower forest",href:"http://minecraft.gamepedia.com/Flower_forest"},MushroomIsland:{iconIndex:29,name:"Mushroom island",href:"http://minecraft.gamepedia.com/Mushroom_Island"},Horse:{iconIndex:34,name:"",href:"http://minecraft.gamepedia.com/Horse"},Wolf:{iconIndex:35,name:"",href:"http://minecraft.gamepedia.com/Wolf"},Dragon:{iconIndex:36,name:"",href:""},SeaMonster:{iconIndex:45,name:"",href:""},Ship:{iconIndex:38,name:"",href:""},Spawn:{iconIndex:40,name:"Spawn",href:""},PlayerStructure:{iconIndex:8,name:"",href:""},PlayerCastle:{iconIndex:9,name:"",href:""},PlayerHouse:{iconIndex:10,name:"",href:""},PlayerFarm:{iconIndex:14,name:"Farm",href:""},PlayerMachine:{iconIndex:12,name:"",href:""},EnchantingRoom:{iconIndex:44,name:"",href:"http://minecraft.gamepedia.com/Enchantment_Table"},Label:{iconIndex:-1,name:"",href:""},FenceOverlay:{iconIndex:13,name:"",href:""},IslandOverlay:{iconIndex:30,name:"",href:""}},LabellingStyle={none:0,smart:1,all:2},LabellingStyleOverride={normal:0,suppress:1,always:2},IconBoundsInformation={0:{width:14,height:16,yOffset:-1},1:{width:14,height:16,yOffset:-1},2:{width:12,height:20,yOffset:0},3:{width:14,height:20,yOffset:-5},4:{width:16,height:17,yOffset:-2},5:{width:10,height:17,yOffset:0},6:{width:10,height:14,yOffset:-2},7:{width:10,height:13,yOffset:-1},8:{width:10,height:10,yOffset:0},9:{width:10,height:14,yOffset:-2},10:{width:12,height:11,yOffset:-1},11:{width:15,height:8,yOffset:0},12:{width:10,height:16,yOffset:-4},13:{width:0,height:0,yOffset:-8},14:{width:16,height:16,yOffset:-1},15:{width:12,height:13,yOffset:0},16:{width:10,height:10,yOffset:0},17:{width:10,height:10,yOffset:0},18:{width:10,height:10,yOffset:0},19:{width:12,height:12,yOffset:0},20:{width:16,height:16,yOffset:0},21:{width:4,height:18,yOffset:0},22:{width:14,height:24,yOffset:-4},23:{width:15,height:16,yOffset:-1},24:{width:15,height:16,yOffset:-1},25:{width:15,height:16,yOffset:-1},26:{width:14,height:14,yOffset:-1},27:{width:20,height:18,yOffset:-3},28:{width:24,height:22,yOffset:-4},29:{width:17,height:16,yOffset:-2},30:{width:0,height:0,yOffset:-8},31:{width:30,height:18,yOffset:0},32:{width:30,height:20,yOffset:-1},33:{width:18,height:16,yOffset:-1},34:{width:18,height:17,yOffset:0},35:{width:17,height:13,yOffset:0},36:{width:30,height:28,yOffset:1},37:{width:27,height:27,yOffset:1},38:{width:29,height:30,yOffset:0},39:{width:20,height:27,yOffset:-2},40:{width:14,height:12,yOffset:0},41:{width:18,height:16,yOffset:0},42:{width:14,height:22,yOffset:-4},43:{width:14,height:16,yOffset:-1},44:{width:14,height:16,yOffset:-1},45:{width:28,height:16,yOffset:1}};MapConfiguration.prototype.SetDefaults=function(){var e=0;"HideLabelsAbove"in this||(this.HideLabelsAbove=e),"ShowLabelsBelow"in this||(this.ShowLabelsBelow=3),"MapRange"in this||(this.MapRange=cMapRangeDefault),"Title"in this||(this.Title="Map of the Overworld"),"Blurb"in this||(this.Blurb="Use up/down or mousewheel to zoom, drag to scroll"),"CustomIconsUri"in this||(this.CustomIconsUri=""),"X"in this||(this.X=0),"Z"in this||(this.Z=0),"ShowOrigin"in this||(this.ShowOrigin=!0),"ShowScale"in this||(this.ShowScale=!0),"ShowCoordinates"in this||(this.ShowCoordinates=!1),"DisableCoordinates"in this||(this.DisableCoordinates=!1),"OceanTheme"in this||(this.OceanTheme="BlueOcean")},MapConfiguration.prototype.AssignFrom=function(e){"MapDataUri"in e&&(this.MapDataUri=e.MapDataUri),"HideLabelsAbove"in e&&(this.HideLabelsAbove=e.HideLabelsAbove),"ShowLabelsBelow"in e&&(this.ShowLabelsBelow=e.ShowLabelsBelow),"MapRange"in e&&(this.MapRange=e.MapRange),"Title"in e&&(this.Title=e.Title),"Blurb"in e&&(this.Blurb=e.Blurb),"CustomIconsUri"in e&&(this.CustomIconsUri=e.CustomIconsUri),"X"in e&&(this.X=e.X),"Z"in e&&(this.Z=e.Z),"ShowOrigin"in e&&(this.ShowOrigin=e.ShowOrigin),"ShowScale"in e&&(this.ShowScale=e.ShowScale),"ShowCoordinates"in e&&(this.ShowCoordinates=e.ShowCoordinates),"DisableCoordinates"in e&&(this.DisableCoordinates=e.DisableCoordinates),"OceanTheme"in e&&(this.OceanTheme=e.OceanTheme)},MapConfiguration.prototype.AssignFromRow=function(e){var t=e.indexOf("=");if(t>0){var i=trim(e.substring(0,t)).toLowerCase(),n=trim(e.slice(t+1));if("z"==i){var a=parseInt(n);isNaN(a)||(this.Z=a)}if("x"==i){var r=parseInt(n);isNaN(r)||(this.X=r)}if("hidelabelsabove"==i){var o=parseInt(n);isNaN(o)||(this.HideLabelsAbove=o)}if("showlabelsbelow"==i){var s=parseInt(n);isNaN(s)||(this.ShowLabelsBelow=s)}if("range"==i){var h=parseInt(n);isNaN(h)||(this.MapRange=h)}"title"==i&&isString(n)&&(this.Title=unquoteString(n)),"blurb"==i&&isString(n)&&(this.Blurb=unquoteString(n)),"icons"==i&&isString(n)&&(this.CustomIconsUri=unquoteString(n)),"googleicons"==i&&isString(n)&&(this.CustomIconsUri="https://googledrive.com/host/"+unquoteString(n)),"showorigin"==i&&isString(n)&&(this.ShowOrigin=stringToBool(n)),"showscale"==i&&isString(n)&&(this.ShowScale=stringToBool(n)),"showcoordinates"==i&&isString(n)&&(this.ShowCoordinates=stringToBool(n)),"disablecoordinates"==i&&isString(n)&&(this.DisableCoordinates=stringToBool(n)),"oceantheme"==i&&isString(n)&&(this.OceanTheme=unquoteString(n))}},MapConfiguration.prototype.AssignFromUrl=function(e){var t=parseURL(e);if(void 0!==Object.keys&&0==Object.keys(t.params).length&&location.host.indexOf("googledrive.com")>20&&(alert('no "src=" url was specified to scrape the location data from.\n\n(On the off-chance you did specify a src parameter and it\'s gone, then Google Drive could be experiencing problems again:\nSee http://buildingwithblocks.info/googlebug for more details)'),this.Abort=!0),"hidelabelsabove"in t.params&&(this.HideLabelsAbove=t.params.hidelabelsabove),"showlabelsbelow"in t.params&&(this.ShowLabelsBelow=t.params.showlabelsbelow),"range"in t.params&&(this.MapRange=t.params.range),"title"in t.params&&isString(t.params.title)&&(this.Title=decodeURIComponent(t.params.title.replace(/\+/g," "))),"blurb"in t.params&&isString(t.params.blurb)&&(this.Blurb=decodeURIComponent(t.params.blurb.replace(/\+/g," "))),"x"in t.params){var i=parseInt(t.params.x);isNaN(i)||(this.X=i)}if("z"in t.params){var n=parseInt(t.params.z);isNaN(n)||(this.Z=n)}"hideorigin"in t.params&&(this.ShowOrigin=!1),"hidescale"in t.params&&(this.ShowScale=!1),"showorigin"in t.params&&isString(t.params.showorigin)&&(this.ShowOrigin=stringToBool(t.params.showorigin)),"showscale"in t.params&&isString(t.params.showscale)&&(this.ShowScale=stringToBool(t.params.showscale)),"showcoordinates"in t.params&&isString(t.params.showcoordinates)&&(this.ShowCoordinates=stringToBool(t.params.showcoordinates)),"src"in t.params&&isString(t.params.src)&&(this.MapDataUri=decodeURIComponent(t.params.src)),"icons"in t.params&&isString(t.params.icons)&&(this.CustomIconsUri=t.params.icons),"googlesrc"in t.params&&isString(t.params.googlesrc)&&(this.MapDataUri=0==t.params.googlesrc.toLowerCase().indexOf("http")?t.params.googlesrc:"https://googledrive.com/host/"+t.params.googlesrc),"googleicons"in t.params&&isString(t.params.googleicons)&&(this.CustomIconsUri="https://googledrive.com/host/"+t.params.googleicons),"oceantheme"in t.params&&isString(t.params.oceantheme)&&(this.OceanTheme=t.params.oceantheme)},MapConfiguration.prototype.GetXTranslationFunction=function(e){var t=e/2,i=this.X,n=this.MapRange;return function(e){return(e-i)*t/n+t}},MapConfiguration.prototype.GetZTranslationFunction=function(e){var t=e/2,i=this.Z,n=this.MapRange;return function(e){return(e-i)*t/n+t}},SuppressableLabel.prototype.toString=function(){return this.text},SuppressableLabel.parse=function(e){var t=new SuppressableLabel(e);if(isString(e)){var i=trim(e);i.length>=2&&(i[0]==cLabel_DontDrawChar&&i[i.length-1]==cLabel_DontDrawChar?t=new SuppressableLabel(i.substring(1,i.length-1),LabellingStyleOverride.suppress):i[0]==cLabel_AlwaysDrawChar&&i[i.length-1]==cLabel_AlwaysDrawChar&&(t=new SuppressableLabel(i.substring(1,i.length-1),LabellingStyleOverride.always)))}return t},Location.prototype.getHref=function(e){return"-"==this.hrefOverride?"":isEmpty(this.hrefOverride)&&1!=e?this.type.href:this.hrefOverride},Location.prototype.getLabel=function(){return isEmpty(this.labelOverride.text)?this.type.name:this.labelOverride.text},Location.prototype.getIconIndex=function(){return isNaN(this.iconIndexOverride)||this.iconIndexOverride<0?this.type.iconIndex:this.iconIndexOverride},Location.prototype.getAlt=function(){var e=this.getLabel();return isEmpty(e)&&!isEmpty(this.owner.text)&&(e=this.owner.text),e},Rectangle.prototype.stroke=function(e,t,i){void 0===t&&(t=0),void 0===i&&(i=0),e.strokeRect(this.x1+t,this.y1+i,this.width,this.height)},Rectangle.prototype.copy=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=0),new Rectangle(this.x1+e,this.y1+t,this.x2+e,this.y2+t)},Rectangle.prototype.intersects=function(e){return this.x2>e.x1&&this.x1<e.x2&&this.y2>e.y1&&this.y1<e.y2},Rectangle.prototype.equals=function(e){return this.x1==e.x1&&this.y1==e.y1&&this.x2==e.x2&&this.y2==e.y2};var cOceanBlocksPerPixel=16,cWorkingCanvasOversample=4,cColor_Black=new RGB(0,0,0),cColor_White=new RGB(255,255,255);RGB.prototype.Blend=function(e,t){t=0>t?0:t>1?1:t;var i=1-t;return new RGB(Math.round(e.R*t+this.R*i),Math.round(e.G*t+this.G*i),Math.round(e.B*t+this.B*i))},RGB.prototype.MatchesRGB=function(e,t,i){return e==this.R&&t==this.G&&i==this.B},RGB.prototype.Matches=function(e){return e instanceof RGB&&e.R==this.R&&e.G==this.G&&e.B==this.B};