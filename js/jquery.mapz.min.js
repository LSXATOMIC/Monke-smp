/** @Preserve
*	jQuery Mapz v1.0
*
*	by Danny van Kooten - http://dannyvankooten.com
*	Last Modification: 20/06/2011
*
*	For more information, visit:
*	http://dannyvankooten.com/jquery-plugins/mapz/
*
*	Licensed under the Creative Commons Attribution 2.5 License - http://creativecommons.org/licenses/by/2.5/
*		- Free for use in both personal and commercial projects
*		- Attribution requires leaving author name, author link, and the license info intact.	
*/
!function(e){e.fn.mapz=function(t){function i(){var t=h.children("map"),i=1,n=0;s.children(".level").each(function(){if(n++,!e(this).hasClass("current-level")){i=e(this).width()/s.width();var o=e(document.createElement("map")).attr("name",s.attr("id")+"-map-"+n);t.children("area").each(function(){var t=e(this).clone(),n=e(this).attr("coords").split(",");for(c in n)n[c]=Math.ceil(n[c]*i);t.attr("coords",n).appendTo(o)}),o.appendTo(h),e(this).attr("usemap","#"+s.attr("id")+"-map-"+n)}})}function n(){l.css({left:-s.width()+h.width(),top:-s.height()+h.height(),width:2*s.width()-h.width(),height:2*s.height()-h.height()}),s.position().left<l.position().left&&s.css("left",l.position().left),s.position().top<l.position().top&&s.css("top",l.position().top)}function o(e){var t=s.children(".current-level");switch(e){case"in":if(0==s.children(".current-level").next().length)return;var i=t.next();break;case"out":if(0==s.children(".current-level").prev().length)return;var i=t.prev()}i.addClass("current-level"),t.removeClass("current-level"),r(i,t)}function r(e,t){var i=(s.position(),h.width()/2),o=h.height()/2,r=-s.position().left,a=-s.position().top,c=e.width()/t.width()*(r+i)-i,l=e.height()/t.height()*(a+o)-o;0>c&&(c=0),0>l&&(l=0),s.css({left:-c,top:-l,width:e.width(),height:e.height()}),n()}var a={zoom:!1,createmaps:!1,mousewheel:!1,pinchzoom:!1};t&&e.extend(a,t);var h=this.parent(".map-viewport"),s=this,l=e(document.createElement("div")).addClass("mapz-constraint").css("position","absolute").appendTo(h);s.children(".level:first").addClass("current-level");var d=s.children(".current-level");if(r(d,d),a.zoom){if(e(document).keydown(function(e){return 38==e.keyCode?(o("in"),!1):40==e.keyCode?(o("out"),!1):void 0}),a.mousewheel&&s.bind("mousewheel",function(e,t){var i=t>0?"in":"out";return o(i),!1}),a.pinchzoom)if("function"==typeof Hammer){var p=.12,u=0;this.hammer().on("pinchin",function(e){e.gesture.scale+u<1-p&&(u+=p,o("out"))}),this.hammer().on("pinchout",function(e){e.gesture.scale+u>1+p&&(u-=p,o("in"))}),this.hammer().on("release",function(){u=0})}else alert("pinchzoom cannot be turned on without hammer library");a.createmaps&&i()}s.draggable({containment:l})}}(jQuery);